---
name: scale2zero
templates:
  pre-start.erb: bin/pre-start
  scale2zero_ctl: bin/scale2zero_ctl
  scale2zero.yml.erb: config/scale2zero.yml

  reverselogproxy_client_ca.crt.erb: config/certs/reverselogproxy_client/ca.crt
  reverselogproxy_client.crt.erb: config/certs/reverselogproxy_client/client.crt
  reverselogproxy_client.key.erb: config/certs/reverselogproxy_client/client.key

  hooks/pre-start.sh.erb: bin/hooks/pre-start.sh
  hooks/pre-stop.sh.erb: bin/hooks/pre-stop.sh
  hooks/post-start.sh.erb: bin/hooks/post-start.sh
  hooks/post-stop.sh.erb: bin/hooks/post-stop.sh
  
packages:
  - java
  - db
  - scale2zero
  - common

properties:
  autoscaler.scale2zero.logging.level:
    description: "The level of logging"
    default: "info"
  autoscaler.application_db.address:
    description: "IP address on which the policydb server will listen"
    default: "scale2zeropostgres.service.cf.internal"
  autoscaler.application_db.databases:
    description: "The list of databases used in policydb database including name"
  autoscaler.application_db.db_scheme:
    description: "Database scheme to be used to access policydb"
  autoscaler.application_db.port:
    description: "Port on which the policydb server will listen"
  autoscaler.application_db.roles:
    description: "The list of database roles used in policydb database including name/password"
  autoscaler.application_db.tls.ca:
    default: ''
    description: 'PEM-encoded ca certificate of tls database server'
  autoscaler.application_db.sslmode:
    default: disable
    description: "The sslmode to connect to postgres server"
  autoscaler.application_db_connection_config.max_open_connections:
    default: 100
  autoscaler.application_db_connection_config.max_idle_connections:
    default: 10
  autoscaler.application_db_connection_config.connection_max_lifetime:
    default: 60s

  autoscaler.scalingengine_db.address:
    description: "IP address on which the policydb server will listen"
    default: "scale2zeropostgres.service.cf.internal"
  autoscaler.scalingengine_db.databases:
    description: "The list of databases used in policydb database including name"
  autoscaler.scalingengine_db.db_scheme:
    description: "Database scheme to be used to access policydb"
  autoscaler.scalingengine_db.port:
    description: "Port on which the policydb server will listen"
  autoscaler.scalingengine_db.roles:
    description: "The list of database roles used in policydb database including name/password"
  autoscaler.scalingengine_db.tls.ca:
    default: ''
    description: 'PEM-encoded ca certificate of tls database server'
  autoscaler.scalingengine_db.sslmode:
    default: disable
    description: "The sslmode to connect to postgres server"
  autoscaler.scalingengine_db_connection_config.max_open_connections:
    default: 100
  autoscaler.scalingengine_db_connection_config.max_idle_connections:
    default: 10
  autoscaler.scalingengine_db_connection_config.connection_max_lifetime:
    default: 60s

  autoscaler.scale2zero.apiserver.server.port:
    default: 8080

  autoscaler.scale2zero.nozzle.rlp_addr:
    description: "The address of ReverseLogProxy"
  autoscaler.scale2zero.nozzle.shard_id:
    description: "The shard id for nozzle to fetch envelopes from ReverseLogProxy"
    default: "CF_AUTOSCALER"
  autoscaler.scale2zero.nozzle.loggregator_rlp_tls.cert:
    description: "PEM-encoded tls client certificate to connect to ReverseLogProxy"
  autoscaler.scale2zero.nozzle.loggregator_rlp_tls.key:
    description: "PEM-encoded tls client key to connect to ReverseLogProxy"
  autoscaler.scale2zero.nozzle.loggregator_rlp_tls.ca_cert:
    description: "PEM-encoded ca certificate of ReverseLogProxy"

  autoscaler.scale2zero.app_manager.app_refresh_interval:
    description: "The time interval to refresh cached application from policy database"
    default: 60s

  autoscaler.scale2zero.router_emitter.flush_interval:
    default: 5s
  autoscaler.scale2zero.route_manager.send_route_interval:
    default: 5s
  autoscaler.scale2zero.route_manager.refresh_app_route_interval:
    default: 5s

  autoscaler.scale2zero.route_listener.ipaddress:
    default: 127.0.0.1
  autoscaler.scale2zero.route_listener.port:
    default: 8081
  autoscaler.scale2zero.aggregator.evaluation_interval:
    default: 5s
  autoscaler.scale2zero.aggregator.app_refresh_interval:
    default: 5s
  
  autoscaler.scale2zero.scaling_engine.lock_size:
    default: 5

  autoscaler.scale2zero.route_chan_size:
    default: 500
  autoscaler.scale2zero.envelop_chan_size:
    default: 500
  autoscaler.scale2zero.trigger_chan_size:
    default: 500
  autoscaler.scale2zero.nozzle_count:
    default: 1
  autoscaler.scale2zero.trigger_worker_count:
    default: 1
  autoscaler.scale2zero.cool_down_duration:
    default: 300s

  autoscaler.cf.api:
    default: api.bosh-lite.com
  autoscaler.cf.client_id:
    default: app-autoscaler
  autoscaler.cf.secret: 
    default: app-autoscaler-secret
  autoscaler.cf.routing_api: 
    default: api.bosh-lite.com/routing
  autoscaler.cf.skip_ssl_validation: 
    default: true

  autoscaler.scale2zero.hooks.pre_start:
    description: "Script to run before starting scale2zero"
    default: ''
    example: |
      #!/bin/bash
      echo "Going to start scale2zero"
      echo "scale2zero data directory is ${DATA_DIR}"
      echo "scale2zero port is ${PORT}"
      echo "scale2zero directory is ${PACKAGE_DIR}"
  autoscaler.scale2zero.hooks.post_start:
    description: "Script to run after scale2zero has started"
    default: ''
  autoscaler.scale2zero.hooks.pre_stop:
    description: "Script to run before stopping scale2zero"
    default: ''
  autoscaler.scale2zero.hooks.post_stop:
    description: "Script to run after scale2zero has stopped"
    default: ''
