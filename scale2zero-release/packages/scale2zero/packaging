set -e -x

export GOROOT=$(readlink -nf /var/vcap/packages/golang)
export PATH=$GOROOT/bin:$PATH
export GOPATH=${BOSH_COMPILE_TARGET}
mkdir -p ${BOSH_COMPILE_TARGET}/src
mv autoscaler ${BOSH_COMPILE_TARGET}/src/
mv code.cloudfoundry.org ${BOSH_COMPILE_TARGET}/src/
mv github.com ${BOSH_COMPILE_TARGET}/src/
mv golang.org ${BOSH_COMPILE_TARGET}/src/
mv google.golang.org ${BOSH_COMPILE_TARGET}/src/
mv gopkg.in ${BOSH_COMPILE_TARGET}/src/

go install autoscaler/cmd/scale2zero
cp -a ${BOSH_COMPILE_TARGET}/bin/scale2zero ${BOSH_INSTALL_TARGET}
cp -a ${BOSH_COMPILE_TARGET}/src/autoscaler/apiserver/db/api.db.changelog.yml ${BOSH_INSTALL_TARGET}
cp -a ${BOSH_COMPILE_TARGET}/src/autoscaler/routemanager/db/routemanager.db.changelog.yml ${BOSH_INSTALL_TARGET}
cp -a ${BOSH_COMPILE_TARGET}/src/autoscaler/scalingengine/db/scalingengine.db.changelog.yml ${BOSH_INSTALL_TARGET}
